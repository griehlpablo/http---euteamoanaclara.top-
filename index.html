<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Eu te amo Ana Clara ‚ù§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="images/icon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Ana Clara ‚ù§">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600;800&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#ffccff;
      --bg2:#ffd6b6;
      --accent:#ff4da6;
      --accent-2:#ff8fb2;
      --card:#ffffffdd;
      --glass: rgba(255,255,255,0.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Montserrat,system-ui,Arial; -webkit-font-smoothing:antialiased;
      background: radial-gradient(circle at 10% 20%, #fff3f8 0%, transparent 15%), linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow-x:hidden;
      overflow-y:auto;
      color:#333;
      padding-bottom: env(safe-area-inset-bottom);
      padding-top: calc(16px + env(safe-area-inset-top));
    }
    .stage{
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:48px 20px;
    }
    .card{
      width:100%; max-width:980px; background:var(--card); border-radius:20px; padding:28px; box-shadow:0 10px 30px rgba(0,0,0,0.12);
      position:relative; overflow:hidden;
      border:1px solid rgba(255,255,255,0.6);
      backdrop-filter: blur(6px);
    }
    header{display:flex; gap:16px; align-items:center}
    .logo{
      width:84px; height:84px; border-radius:20px; background:linear-gradient(180deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:28px; font-family: 'Great Vibes', cursive; box-shadow:0 6px 20px rgba(255,77,166,0.18);
      flex-shrink:0;
    }
    h1{margin:0; font-size:26px}
    p.lead{margin:4px 0 0 0; opacity:0.9}

    .main-grid{display:grid; grid-template-columns: 1fr 360px; gap:20px; margin-top:18px}
    @media (max-width:900px){ .main-grid{grid-template-columns:1fr} .right-col{order:-1} }

    .left-col{padding:12px}
    .right-col{padding:12px}

    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9)); border-radius:12px; padding:14px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);}

    .range-wrap{display:flex; flex-direction:column; gap:8px}
    .range-value{font-weight:700; font-size:18px; color:var(--accent)}
    input[type=range]{width:100%; accent-color:var(--accent); height:36px}

    .forgive{display:flex; gap:10px}
    .btn{padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:700; touch-action:manipulation}
    .btn-sim{background:linear-gradient(90deg,#ff9fc9,#ff4da6); color:white}
    .btn-nao{background:linear-gradient(90deg,#ffd6d6,#ffc9ff); color:#333}

    .gallery{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .thumb-wrapper{position:relative; display:inline-block;}
    .thumb{width:72px;height:72px; border-radius:8px; object-fit:cover; border:3px solid white; box-shadow:0 6px 18px rgba(0,0,0,0.08); cursor:pointer}
    .thumb-remove{
      position:absolute;
      top:2px; right:2px;
      width:20px; height:20px;
      border-radius:999px;
      background:rgba(0,0,0,0.7);
      color:#fff;
      border:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      cursor:pointer;
    }
    .thumb-remove:hover{background:rgba(0,0,0,0.9);}

    .message-box{margin-top:12px; border-radius:12px; padding:12px; background:var(--glass)}
    .message-box textarea{width:100%; min-height:120px; border-radius:8px; padding:12px; border:0; resize:vertical; font-size:15px}
    .big-love{display:flex; gap:8px; align-items:center; justify-content:space-between}

    .action-row{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}

    footer{margin-top:18px; text-align:center; opacity:0.8}

    .hearts-layer{pointer-events:none; position:absolute; inset:0; overflow:hidden}
    .heart{position:absolute; transform:translateY(-120%); will-change:transform,opacity; font-size:22px; opacity:0.9;}

    .burst{position:absolute; inset:0; pointer-events:none}
    .burst .bheart{position:absolute; font-size:20px}

    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:60;
      padding:16px;
      background:rgba(0,0,0,0.25);
    }
    .overlay.show{display:flex}

    .overlay-card{
      background:linear-gradient(180deg,#fff,#ffeef8);
      border-radius:18px;
      padding:28px;
      max-width:720px;
      width:100%;
      text-align:center;
      box-shadow:0 16px 40px rgba(0,0,0,0.2);
    }
    .overlay-card h2{font-family:'Great Vibes',cursive; font-size:48px; margin:0}
    .small{font-size:13px; opacity:0.85}

    .letter-card{
      background:#fffdf8;
      border-radius:20px;
      padding:26px 22px 22px;
      max-width:780px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
      box-shadow:0 18px 40px rgba(0,0,0,0.28);
      border:1px solid #f5e1c3;
      position:relative;
    }
    .letter-card:before{
      content:"";
      position:absolute;
      inset:12px;
      border-radius:14px;
      border:1px dashed rgba(0,0,0,0.08);
      pointer-events:none;
    }
    .ring-icon{
      font-size:42px;
      margin-bottom:8px;
    }
    .letter-title{
      font-family:'Great Vibes',cursive;
      font-size:40px;
      margin:0 0 8px;
      text-align:center;
    }
    .letter-body{
      text-align:left;
      font-size:15px;
      line-height:1.6;
      margin-top:8px;
    }
    .letter-body strong{color:var(--accent)}

    .footer-hearts{display:flex; gap:6px; justify-content:center; margin-top:10px}

    @keyframes fall{
      to{transform:translateY(120vh) rotate(360deg); opacity:0.05}
    }

    /* Hero/carrossel */
    #heroImg{
      transition:opacity .6s ease;
    }
    #heroImg.fade-out{opacity:0;}
    #heroImg.fade-in{opacity:1;}

    /* Painel de satisfa√ß√£o */
    .satisfaction-wrapper{
      margin-top:24px;
      display:flex;
      justify-content:center;
    }
    .satisfaction-card{
      max-width:520px;
      width:100%;
      background:rgba(255,255,255,0.96);
      border-radius:18px;
      padding:18px 16px 18px;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);
      border:1px solid rgba(255,255,255,0.8);
      position:relative;
      overflow:hidden;
    }
    .satisfaction-card h2{
      margin:0 0 4px;
      font-size:20px;
    }
    .sat-sub{
      margin:0 0 10px;
      font-size:13px;
      opacity:0.8;
    }
    .who-are-you{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:13px;
      margin-bottom:6px;
      flex-wrap:wrap;
    }
    .sat-user-btn{
      border:0;
      padding:6px 10px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      background:#ffe4f4;
      color:#b10061;
      font-weight:600;
    }
    .sat-user-btn.active{
      background:linear-gradient(90deg,#ff9fc9,#ff4da6);
      color:#fff;
    }
    .sat-current{
      margin:0 0 8px;
      font-size:12px;
      opacity:0.8;
    }
    .sat-board{
      border-radius:12px;
      background:#fff;
      border:1px solid rgba(0,0,0,0.06);
      overflow:hidden;
    }
    .sat-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 10px;
      font-size:15px;
      cursor:pointer;
    }
    .sat-row:nth-child(odd){
      background:#fff9fd;
    }
    .sat-row:nth-child(even){
      background:#fff;
    }
    .sat-row:hover{
      background:#ffe9f7;
    }
    .sat-label{
      flex:1;
    }
    .sat-markers{
      display:flex;
      gap:6px;
      min-width:80px;
      justify-content:flex-end;
    }
    .sat-marker{
      min-width:40px;
      height:32px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:15px;
      color:#fff;
      font-weight:700;
      box-shadow:0 4px 10px rgba(0,0,0,0.18);
      padding:0 8px;
      background:linear-gradient(135deg,#4f46e5,#6366f1);
    }
    .sat-marker-ana{
      background:linear-gradient(135deg,#ec4899,#f97316);
    }
    .sat-tip{
      margin-top:10px;
      font-size:11px;
      opacity:0.75;
    }
    .jail-extra textarea{
      width:100%;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.12);
      padding:8px;
      font-size:13px;
      resize:vertical;
    }
    .jail-anim{
      position:absolute;
      inset:0;
      display:flex;
      justify-content:center;
      align-items:center;
      pointer-events:none;
      z-index:40;
    }
    .jail-bars{
      width:82%;
      height:70%;
      border-radius:16px;
      border:4px solid rgba(0,0,0,0.85);
      display:flex;
      justify-content:space-around;
      align-items:stretch;
      background:rgba(0,0,0,0.08);
      overflow:hidden;
      animation:jailClose 700ms ease-out forwards;
    }
    .jail-bars span{
      flex:1;
      margin:0 4px;
      background:rgba(0,0,0,0.82);
      border-radius:999px;
      transform:translateY(-120%);
      animation:barDrop 700ms ease-out forwards;
    }
    @keyframes jailClose{
      from{opacity:0; transform:scale(1.1);}
      to{opacity:1; transform:scale(1);}
    }
    @keyframes barDrop{
      from{transform:translateY(-120%);}
      to{transform:translateY(0);}
    }


    /* Contagem regressiva */
    .countdown-panel .countdown-time{
      font-size:26px;
      font-weight:800;
      color:var(--accent);
      letter-spacing:1px;
      margin:10px 0 4px;
    }
    .countdown-panel .countdown-time span{
      display:inline-block;
      min-width:52px;
    }
    .countdown-panel .countdown-msg{
      font-size:13px;
      opacity:0.85;
    }

    /* Enquetes */
    .polls-wrapper{
      margin-top:20px;
      display:flex;
      justify-content:center;
    }
    .poll-card{
      max-width:520px;
      width:100%;
    }
    .poll-card h2{
      margin:0 0 6px;
      font-size:20px;
    }
    .poll-sub{
      margin:0 0 10px;
      font-size:12px;
      opacity:0.8;
    }
    .poll-block{
      margin-top:10px;
      padding-top:8px;
      border-top:1px dashed rgba(0,0,0,0.08);
    }
    .poll-title{
      font-weight:600;
      margin-bottom:4px;
      font-size:15px;
    }
    .poll-options{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:4px;
    }
    .poll-btn{
      flex:1 1 100px;
    }
    .poll-btn.selected{
      box-shadow:0 0 0 2px rgba(255,77,166,0.6);
      transform:translateY(-1px);
    }
    .menu-textarea{
      width:100%;
      min-height:70px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.12);
      padding:8px;
      font-size:14px;
      resize:vertical;
    }

    @media (max-width:900px){
      .stage{
        align-items:flex-start;
        padding:24px 12px 32px;
      }
    }
    @media (max-width:420px){
      .card{padding:18px; border-radius:16px}
      header{gap:12px}
      .logo{width:70px;height:70px;font-size:24px}
      h1{font-size:20px}
      .overlay-card{padding:20px}
      .overlay-card h2{font-size:34px}
      .letter-card{padding:20px 16px}
      .letter-title{font-size:32px}

      .main-grid{grid-template-columns:1fr}
      .right-col{order:2}
      .left-col{order:1}

      .forgive{flex-direction:column}
      .forgive .btn{width:100%; padding:12px; font-size:16px}
      .action-row{flex-direction:column}
      .action-row .btn{width:100%}

      .thumb{width:60px;height:60px}
      .message-box textarea{min-height:100px}

      .heart{font-size:26px}
      .satisfaction-card{
        padding:14px 12px 16px;
      }
      .satisfaction-card h2{
        font-size:17px;
      }
      .sat-row{
        padding:8px 8px;
        font-size:14px;
      }
    }
    @media (max-width:360px){
      .logo{width:60px;height:60px;font-size:20px}
      h1{font-size:18px}
      .overlay-card h2{font-size:28px}
      .thumb{width:52px;height:52px}
    }
    @media (hover:none){
      .btn{padding:14px 16px; border-radius:12px}
      input[type=range]{height:44px}
    }
    @media (max-width:700px){
      .overlay{
        align-items:flex-start;
        justify-content:center;
        overflow-y:auto;
      }
      .letter-card,
      .overlay-card{
        margin-top:40px;
        margin-bottom:40px;
      }
    }
  </style>
</head>
<body>
  <div class="stage">
    <div class="card" id="card">
      <div class="hearts-layer" id="heartsLayer"></div>
      <header>
        <div class="logo">‚ù§</div>
        <div>
          <h1>Eu te amo, Ana Clara</h1>
          <p class="lead">Um site s√≥ pra voc√™ ‚Äî com muito amor, carinho e cora√ß√µes üíñ</p>
        </div>
      </header>

      <div class="main-grid">
        <div class="left-col">
          <div class="panel">
            <h3>Quanto voc√™ ama o Pablo?</h3>
            <div class="range-wrap">
              <div style="display:flex; align-items:center; justify-content:space-between">
                <div class="range-value">N√≠vel: <span id="loveVal">10</span>/10</div>
                <div class="small">Deslize para escolher</div>
              </div>
              <input id="loveRange" type="range" min="0" max="10" step="1" value="10">
              <small class="small">Dica: ele merece 10 sempre üòâ</small>
            </div>

            <hr style="margin:12px 0">

            <h3>Perdoa o Pablo?</h3>
            <div class="forgive">
              <button class="btn btn-sim" id="btnSim">SIM</button>
              <button class="btn btn-nao" id="btnNao">N√ÉO</button>
            </div>

            <div style="margin-top:12px">
              <label class="small">Fotos nossas:</label>
              <div class="gallery" id="gallery"></div>
              <small class="small" style="display:block; margin-top:4px;">Voc√™s podem adicionar fotos direto do celular. Elas ficam salvas e aparecem em todos os dispositivos üíñ</small>
              <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
                <input id="fileInput" type="file" accept="image/*" multiple style="flex:1 1 180px;">
                <button class="btn btn-sim" id="savePhotosBtn" style="flex:0 0 auto;">Salvar fotos</button>
              </div>
            </div>

          </div>

          <div class="panel message-box">
            <div class="big-love">
              <strong>Mensagem do Pablo pra voc√™</strong>
              <div class="footer-hearts">‚ù§ ‚ù§ ‚ù§</div>
            </div>
            <textarea id="loveMsg">Ana Clara, cada batida do meu cora√ß√£o lembra seu nome. Voc√™ √© minha companheirinha, meu sorriso e meu porto seguro. Eu te amo mais do que palavras conseguem dizer. Sempre seu, Pablo.</textarea>
            <div class="action-row">
              <button class="btn btn-sim" id="showMsg">Mostrar em grande</button>
              <button class="btn btn-nao" id="surprise">Surpresa (cora√ß√µes)</button>
              <button class="btn btn-sim" id="proposalBtn">Clique aqui para descobrir üíå</button>
            </div>
          </div>

        </div>

        <aside class="right-col">
          <div class="panel" style="text-align:center">
            <h3>Galeria & momento</h3>
            <p class="small">As fotos v√£o passando sozinhas, mas voc√™ pode tocar em qualquer miniatura pra escolher üíï</p>
            <div style="margin-top:10px">
              <img id="heroImg" src="images/wedding.jpg" alt="foto destaque" style="width:100%; border-radius:12px; display:block; object-fit:cover; max-height:320px">
            </div>
            <div style="margin-top:12px; text-align:left">
              <small class="small">Dica: se o slider ficar menor que 10, ele volta pra 10 automaticamente ‚Äî porque voc√™ merece tudo.</small>
            </div>
          </div>

          <div style="height:14px"></div>

          <!-- Contagem regressiva para o encontro -->
          <div class="panel countdown-panel" style="text-align:center">
            <h3>Contagem para nosso pr√≥ximo encontro ‚è≥</h3>
            <p class="small">
              Encontro em <strong>19/11/2025 √†s 18h</strong> (hor√°rio de Bras√≠lia).
            </p>
            <div class="countdown-time" id="countdownTime">
              --d --h --m --s
            </div>
            <p class="small countdown-msg" id="countdownMsg">
              Carregando contagem...
            </p>
          </div>

          <div style="height:14px"></div>

          <div class="panel" style="text-align:center">
            <h3>Brilhos & Cora√ß√µes</h3>
            <p class="small">Cora√ß√µes caem na p√°gina quando voc√™ visita ou quando algo especial acontece.</p>
            <div style="margin-top:8px">
              <button class="btn btn-sim" id="popupLove">Mostrar Amor</button>
            </div>
          </div>

        </aside>
      </div>

      <!-- Painel de satisfa√ß√£o -->
      <section class="satisfaction-wrapper">
        <div class="satisfaction-card">
          <h2>N√≠vel de satisfa√ß√£o com o moz√£o üòè</h2>
          <p class="sat-sub">
            Escolha quem voc√™ √© e clique em um n√≠vel. Cada voto mexe o marcador da outra pessoa.
          </p>

          <div class="who-are-you">
            <span>Eu sou:</span>
            <button class="sat-user-btn" data-user="pablo">Pablo (namorado)</button>
            <button class="sat-user-btn" data-user="ana">Ana Clara (namorada)</button>
          </div>
          <p class="sat-current">
            Voc√™ est√° logado como: <strong id="satCurrentUser">ningu√©m</strong>
          </p>

          <div class="sat-board">
            <div class="sat-row" data-level="perfect">
              <span class="sat-label">Amorzinho perfeito(a) üíò</span>
              <div class="sat-markers"></div>
            </div>
            <div class="sat-row" data-level="good">
              <span class="sat-label">Muito bonzinho(a) ‚≠ê</span>
              <div class="sat-markers"></div>
            </div>
            <div class="sat-row" data-level="chill">
              <span class="sat-label">De boa / Chill üòé</span>
              <div class="sat-markers"></div>
            </div>
            <div class="sat-row" data-level="ice">
              <span class="sat-label">Em gelo fino üßä</span>
              <div class="sat-markers"></div>
            </div>
            <div class="sat-row" data-level="jail">
              <span class="sat-label">Cadeia (ai, ai, ai) ‚õìÔ∏è</span>
              <div class="sat-markers"></div>
            </div>
          </div>

          <!-- Marcadores -->
          <div class="sat-marker sat-marker-pablo" data-user="pablo">P üíò</div>
          <div class="sat-marker sat-marker-ana" data-user="ana">A üíò</div>

          <p class="sat-tip">
            Quando voc√™ entra como Ana, mexe o P (avaliando o Pablo). Quando entra como Pablo, mexe o A (avaliando a Ana).
          </p>

          <div class="jail-extra" id="jailExtra" style="display:none; margin-top:10px;">
            <p id="jailLabel" class="sat-sub" style="margin-bottom:6px;"></p>
            <textarea id="jailText" rows="3" placeholder="Escreva aqui o que a pessoa precisa fazer para sair da cadeia..."></textarea>
            <button class="btn btn-nao" id="jailSaveBtn" style="margin-top:6px; width:100%;">Salvar plano para sair da cadeia</button>
          </div>
        </div>
      </section>

      <!-- ENQUETES -->
      <section class="polls-wrapper">
        <div class="panel poll-card">
          <h2>Enquetes do dia üí≠</h2>
          <p class="poll-sub">As respostas ficam salvas pra voc√™s dois verem, em qualquer dispositivo.</p>

          <div class="poll-block" id="pollSexo">
            <div class="poll-title">Sexo hoje: sim ou n√£o? üòè</div>
            <div class="poll-options">
              <button class="btn btn-sim poll-btn" data-poll="sexo" data-value="sim">Sim üòà</button>
              <button class="btn btn-nao poll-btn" data-poll="sexo" data-value="nao">N√£o üôÖ‚Äç‚ôÄÔ∏è</button>
            </div>
            <p class="small" id="pollSexoStatus" style="margin-top:6px;">Ainda sem resposta hoje.</p>
          </div>

          <div class="poll-block" id="pollMenu">
            <div class="poll-title">Card√°pio do dia üçΩÔ∏è</div>
            <textarea id="menuInput" class="menu-textarea" placeholder="Ex.: noite do macarr√£o, pedir sushi, ver filme com pipoca..."></textarea>
            <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn btn-sim" id="menuSaveBtn">Salvar card√°pio</button>
            </div>
            <p class="small" id="menuStatus" style="margin-top:6px;">Sem sugest√£o ainda. Escrevam algo gostoso pra hoje üòã</p>
          </div>
        </div>
      </section>

      <footer>
        Feito com ‚ô• por Pablo ‚Äî EU TE AMO SUPER HIPER MEGA.
      </footer>

    </div>
  </div>

  <!-- Overlay mensagem grande -->
  <div class="overlay" id="overlay">
    <div class="overlay-card">
      <h2 id="overlayTitle">Eu te amo, Ana Clara ‚ù§</h2>
      <p id="overlayText" class="small">Uma mensagem especial do Pablo.</p>
      <div style="margin-top:14px"><button class="btn btn-sim" id="closeOverlay">Fechar</button></div>
    </div>
  </div>

  <!-- Overlay da carta de pedido de casamento -->
  <div class="overlay" id="proposalOverlay">
    <div class="letter-card">
      <div class="ring-icon">üíç</div>
      <h2 class="letter-title">Minha Ana Clara, quer casar comigo?</h2>
      <div class="letter-body">
        <p>Amor, a gente briga, discorda, se enrola na vida... mas em todas as vers√µes da minha hist√≥ria, <strong>voc√™</strong> est√° l√°.</p>
        <p>Mesmo nos dias dif√≠ceis, √© com voc√™ que eu quero conversar, rir, dividir o caf√©, o cansa√ßo e os sonhos. Eu n√£o me imagino em um futuro em que voc√™ n√£o esteja do meu lado.</p>
        <p>Eu te amo de um jeito que n√£o cabe s√≥ em palavras, nem s√≥ num site cheio de cora√ß√µes caindo. Eu te amo no sil√™ncio, nos detalhes, nas piadas internas e at√© nas nossas teimosias.</p>
        <p>Por isso, com todo o amor e todo o medo e toda a coragem do mundo, eu quero te perguntar de verdade:</p>
        <p style="text-align:center; font-size:18px; margin-top:8px;"><strong>Voc√™ aceita viver pra sempre comigo?</strong></p>
        <p style="margin-top:10px;">Quero caminhar ao seu lado, construir uma casa que tenha a nossa cara, nossos cheiros, nossas manias e muitos gatinhos (ou peixinhos, quem sabe üêü). Quero envelhecer rindo das nossas hist√≥rias e lembrando de quando tudo come√ßou.</p>
        <p>Eu te amo, Ana Clara. Hoje, amanh√£ e depois. Para sempre seu,</p>
        <p><strong>Pablo üíñ</strong></p>
      </div>
      <div style="margin-top:16px; text-align:center;">
        <button class="btn btn-sim" id="closeProposal">Fechar essa carta (por enquanto)</button>
      </div>
    </div>
  </div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDS1YA0FRvCIryjreFVzRMZyaHhYtm-pUU",
      authDomain: "euteamoanaclaraks.firebaseapp.com",
      databaseURL: "https://euteamoanaclaraks-default-rtdb.firebaseio.com",
      projectId: "euteamoanaclaraks",
      storageBucket: "euteamoanaclaraks.firebasestorage.app",
      messagingSenderId: "972847187116",
      appId: "1:972847187116:web:016a7b8a3dd7a688320b09",
      measurementId: "G-7LN9PKSCW3"
    };

    let db = null;
    try{
      firebase.initializeApp(firebaseConfig);
      db = firebase.database();
      console.log("Firebase inicializado (Realtime DB).");
    }catch(e){
      console.warn("Firebase n√£o inicializou, mas o site continua funcionando.", e);
    }
    const coupleId = "pablo-ana";

    const heartsLayer = document.getElementById('heartsLayer');
    function spawnHeart(x){
      const el = document.createElement('span');
      el.className = 'heart';
      el.innerText = '‚ù§';
      const size = Math.random()*18 + 14;
      el.style.left = (x != null ? x : Math.random()*100) + 'vw';
      el.style.fontSize = size + 'px';
      const dur = Math.random()*5 + 5;
      el.style.animation = `fall ${dur}s linear forwards`;
      el.style.opacity = (Math.random()*0.4)+0.6;
      heartsLayer.appendChild(el);
      setTimeout(()=> el.remove(), (dur+0.6)*1000);
    }
    function initialRain(count=22){
      for(let i=0;i<count;i++){
        setTimeout(()=>spawnHeart(), i*120);
      }
    }
    initialRain(26);
    setInterval(()=>{ spawnHeart(Math.random()*100); }, 8000);

    // Slider amor
    const loveRange = document.getElementById('loveRange');
    const loveVal = document.getElementById('loveVal');
    loveRange.addEventListener('input', function(){
      const v = Number(this.value);
      loveVal.innerText = v;
      if(window._loveRevertTimeout) clearTimeout(window._loveRevertTimeout);
      if(v < 10){
        window._loveRevertTimeout = setTimeout(()=>{
          loveRange.value = 10;
          loveVal.innerText = 10;
          popupHeartsBurst();
          showTinyNote('Pra sempre 10/10 ‚ú®');
          window._loveRevertTimeout = null;
        }, 1000);
      } else {
        if(window._loveRevertTimeout){
          clearTimeout(window._loveRevertTimeout);
          window._loveRevertTimeout = null;
        }
      }
    });

    // Perdoa Pablo
    const btnSim = document.getElementById('btnSim');
    const btnNao = document.getElementById('btnNao');
    btnSim.onclick = ()=>{
      btnSim.innerText = 'SIM ‚ù§';
      btnNao.innerText = 'N√ÉO';
      popupHeartsBurst();
    };
    btnNao.onclick = ()=>{
      btnSim.innerText = 'SIM ‚ù§';
      btnNao.innerText = 'N√ÉO ‚ûú agora √© SIM';
      popupHeartsBurst();
      setTimeout(()=>{ btnNao.innerText = 'N√ÉO'; }, 900);
    };

    // Galeria + carrossel
    const gallery = document.getElementById('gallery');
    const heroImg = document.getElementById('heroImg');
    let heroSources = [];
    let currentHeroIndex = 0;
    let heroTimer = null;

    function registerHeroSrc(src){
      if(!src) return;
      if(!heroSources.includes(src)){
        heroSources.push(src);
      }
    }
    function setHeroFromSrc(src, fromCarousel=false){
      if(!src) return;
      registerHeroSrc(src);
      const img = heroImg;
      img.classList.remove('fade-in');
      img.classList.add('fade-out');
      setTimeout(()=>{
        img.src = src;
        img.classList.remove('fade-out');
        img.classList.add('fade-in');
      }, 220);
      if(!fromCarousel){
        const idx = heroSources.indexOf(src);
        if(idx >= 0) currentHeroIndex = idx;
      }
    }
    function startHeroCarousel(){
      if(heroTimer) clearInterval(heroTimer);
      heroTimer = setInterval(()=>{
        if(heroSources.length <= 1) return;
        currentHeroIndex = (currentHeroIndex + 1) % heroSources.length;
        const nextSrc = heroSources[currentHeroIndex];
        setHeroFromSrc(nextSrc, true);
      }, 6000);
    }
    function createThumb(src, isDynamic=false, photoId=null){
      registerHeroSrc(src);
      const wrap = document.createElement('div');
      wrap.className = 'thumb-wrapper';
      if(isDynamic && photoId){ wrap.dataset.photoId = photoId; }
      const img = document.createElement('img');
      img.src = src;
      img.className = 'thumb' + (isDynamic ? ' dynamic-photo' : '');
      img.addEventListener('click', ()=> setHeroFromSrc(src));
      wrap.appendChild(img);
      if(isDynamic && photoId){
        const btn = document.createElement('button');
        btn.className = 'thumb-remove';
        btn.innerText = '√ó';
        btn.title = 'Remover esta foto';
        btn.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          if(!confirm('Tem certeza que quer remover esta foto da galeria?')) return;
          if(db){
            firebase.database().ref('gallery/' + coupleId + '/' + photoId).remove()
              .then(()=> { showTinyNote('Foto removida üóëÔ∏è'); heroSources = heroSources.filter(u => u !== src);})
              .catch(err => { console.warn('Erro ao remover foto:', err); showTinyNote('N√£o consegui remover üò¢'); });
          } else {
            wrap.remove();
            heroSources = heroSources.filter(u => u !== src);
          }
        });
        wrap.appendChild(btn);
      }
      gallery.appendChild(wrap);
    }

    // Fotos fixas
    createThumb('images/ana_e_eu_zoo.jpg');
    createThumb('images/us_beach.jpg');
    createThumb('images/us_zoo.jpg');
    createThumb('images/wedding.jpg');
    setHeroFromSrc('images/wedding.jpg');
    startHeroCarousel();

    // Upload fotos -> Realtime DB
    const fileInput = document.getElementById('fileInput');
    const savePhotosBtn = document.getElementById('savePhotosBtn');

    savePhotosBtn.addEventListener('click', () => {
      const files = Array.from(fileInput.files || []);
      if(!files.length){
        alert('Escolha pelo menos uma foto primeiro üôÇ');
        return;
      }
      if(!db){
        showTinyNote('Firebase n√£o dispon√≠vel, n√£o consegui salvar üò¢');
        return;
      }
      files.forEach(file => {
        if(!file.type.startsWith('image/')) return;
        const reader = new FileReader();
        reader.onload = function(ev){
          const dataUrl = ev.target.result;
          firebase.database().ref('gallery/' + coupleId).push({
            dataUrl,
            name: file.name || null,
            createdAt: Date.now()
          }).then(()=>{
            showTinyNote('Foto salva na galeria üíñ');
          }).catch(err => {
            console.warn('Erro ao salvar foto:', err);
            showTinyNote('N√£o consegui salvar uma das fotos üò¢');
          });
        };
        reader.readAsDataURL(file);
      });
      fileInput.value = '';
    });

        if(db){
      firebase.database()
        .ref('gallery/' + coupleId)
        .orderByChild('createdAt')
        .limitToLast(60) // carrega s√≥ as 60 √∫ltimas fotos
        .on('value', snapshot => {
          const data = snapshot.val();
          
          // Remove as fotos din√¢micas antigas do HTML
          const oldDyn = gallery.querySelectorAll('.dynamic-photo');
          oldDyn.forEach(el => el.parentElement && el.parentElement.remove());

          if(!data){
            console.log('Nenhuma foto din√¢mica no Firebase.');
            return;
          }

          // Ordena por createdAt (do mais antigo pro mais novo)
          const entries = Object.entries(data).sort((a,b) => {
            const va = (a[1] && a[1].createdAt) || 0;
            const vb = (b[1] && b[1].createdAt) || 0;
            return va - vb;
          });

          // Cria os thumbs
          entries.forEach(([id, item]) => {
            if(!item || !item.dataUrl) return;
            createThumb(item.dataUrl, true, id);
          });
        }, err => {
          console.warn('Erro ao ler galeria do Firebase:', err);
        });
    }


    // Overlays
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayText = document.getElementById('overlayText');
    const showMsg = document.getElementById('showMsg');
    const closeOverlay = document.getElementById('closeOverlay');
    showMsg.onclick = ()=>{
      overlayTitle.innerText = 'Ana Clara, eu te amo ‚ù§';
      overlayText.innerText = document.getElementById('loveMsg').value;
      overlay.classList.add('show');
      initialRain(40);
    };
    closeOverlay.onclick = ()=> overlay.classList.remove('show');

    const proposalBtn = document.getElementById('proposalBtn');
    const proposalOverlay = document.getElementById('proposalOverlay');
    const closeProposal = document.getElementById('closeProposal');
    proposalBtn.onclick = ()=>{
      proposalOverlay.classList.add('show');
      initialRain(35);
    };
    closeProposal.onclick = ()=> proposalOverlay.classList.remove('show');

    document.getElementById('surprise').onclick = ()=>{ initialRain(36); popupHeartsBurst(); };
    document.getElementById('popupLove').onclick = ()=>{ initialRain(30); popupHeartsBurst(); };

    function popupHeartsBurst(){
      const burst = document.createElement('div');
      burst.className='burst';
      document.body.appendChild(burst);
      for(let i=0;i<18;i++){
        const b = document.createElement('div'); b.className='bheart'; b.innerText='‚ù§';
        const angle = Math.random()*Math.PI*2; const radius = Math.random()*140+20;
        b.style.left = (50 + Math.cos(angle)*radius) + 'vw';
        b.style.top = (40 + Math.sin(angle)*radius) + 'vh';
        b.style.opacity = 1; b.style.transform = 'scale(0.9)';
        b.style.transition = 'transform 900ms cubic-bezier(.2,1,.3,1), opacity 900ms';
        burst.appendChild(b);
        setTimeout(()=>{ b.style.transform='translateY(-40vh) scale(1.2)'; b.style.opacity=0; }, 40+i*20);
      }
      setTimeout(()=> burst.remove(), 1200);
    }

    function popupEmojiBurst(emoji){
      const burst = document.createElement('div');
      burst.className='burst';
      document.body.appendChild(burst);
      for(let i=0;i<14;i++){
        const b = document.createElement('div'); b.className='bheart'; b.innerText=emoji;
        const angle = Math.random()*Math.PI*2; const radius = Math.random()*140+20;
        b.style.left = (50 + Math.cos(angle)*radius) + 'vw';
        b.style.top = (45 + Math.sin(angle)*radius) + 'vh';
        b.style.opacity = 1; b.style.transform = 'scale(0.9)';
        b.style.transition = 'transform 900ms cubic-bezier(.2,1,.3,1), opacity 900ms';
        burst.appendChild(b);
        setTimeout(()=>{ b.style.transform='translateY(-40vh) scale(1.2)'; b.style.opacity=0; }, 40+i*20);
      }
      setTimeout(()=> burst.remove(), 1200);
    }

    function iceRain(){
      const container = document.createElement('div');
      container.className = 'burst';
      document.body.appendChild(container);
      for(let i=0;i<18;i++){
        const ice = document.createElement('div');
        ice.className = 'bheart';
        ice.innerText = 'üßä';
        const startX = Math.random()*100;
        ice.style.left = startX + 'vw';
        ice.style.top = '-10vh';
        ice.style.opacity = 1;
        ice.style.transform = 'scale(1)';
        ice.style.transition = 'transform 1300ms ease-out, top 1300ms linear, opacity 1300ms ease-out';
        container.appendChild(ice);
        setTimeout(()=>{
          ice.style.top = '100vh';
          ice.style.transform = 'scale(0.4)';
          ice.style.opacity = 0;
        }, 30 + i*35);
      }
      setTimeout(()=> container.remove(), 1500);
    }

    function showTinyNote(text){
      const t = document.createElement('div');
      t.style.position='fixed'; t.style.right='18px'; t.style.bottom='18px'; t.style.padding='10px 14px'; t.style.background='linear-gradient(90deg,#ff9fc9,#ff4da6)'; t.style.color='white'; t.style.borderRadius='12px'; t.style.boxShadow='0 6px 20px rgba(0,0,0,0.18)'; t.style.zIndex=999; t.innerText=text;
      document.body.appendChild(t);
      setTimeout(()=> t.style.opacity=0, 1600);
      setTimeout(()=> t.remove(), 2100);
    }

    // Painel de satisfa√ß√£o
    const satButtons = document.querySelectorAll('.sat-user-btn');
    const satCurrentUserLabel = document.getElementById('satCurrentUser');
    const satRows = document.querySelectorAll('.sat-row');
    const markerPablo = document.querySelector('.sat-marker-pablo');
    const markerAna   = document.querySelector('.sat-marker-ana');
    const satCard = document.querySelector('.satisfaction-card');

    const levelEmoji = {
      perfect: 'üíò',
      good: '‚≠ê',
      chill: 'üòé',
      ice: 'üßä',
      jail: '‚õìÔ∏è'
    };

    let currentUser = localStorage.getItem('satCurrentUser') || null;
    const jailExtra = document.getElementById('jailExtra');
    const jailLabel = document.getElementById('jailLabel');
    const jailText = document.getElementById('jailText');
    const jailSaveBtn = document.getElementById('jailSaveBtn');
    let jailStatus = {pablo:false, ana:false};
    let jailFor = null;

    function updateCurrentUserUI(){
      satButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.user === currentUser);
      });
      satCurrentUserLabel.textContent = currentUser ? 
        (currentUser === 'pablo' ? 'Pablo (namorado)' : 'Ana Clara (namorada)') : 
        'ningu√©m';
    }

    satButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        currentUser = btn.dataset.user;
        localStorage.setItem('satCurrentUser', currentUser);
        updateCurrentUserUI();
      });
    });
    updateCurrentUserUI();

    const levelMap = {};
    satRows.forEach(row => {
      levelMap[row.dataset.level] = row;
      row.addEventListener('click', () => {
        if(!currentUser){
          alert('Escolhe se voc√™ √© o Pablo ou a Ana primeiro üòâ');
          return;
        }
        const levelKey = row.dataset.level;
        const targetUser = currentUser === 'pablo' ? 'ana' : 'pablo';

        placeMarker(targetUser, levelKey);

        localStorage.setItem('satLevel_' + targetUser, levelKey);

        if(levelKey === 'perfect'){
          initialRain(24);
          popupHeartsBurst();
          popupEmojiBurst('üíò');
          popupEmojiBurst('üî•');
          showTinyNote((targetUser === 'pablo' ? 'Pablo' : 'Ana') + ' √© amorzinho perfeito(a)!');
        } else if(levelKey === 'good'){
          popupEmojiBurst('‚≠ê');
          showTinyNote((targetUser === 'pablo' ? 'Pablo' : 'Ana') + ' est√° muito bonzinho(a) ‚≠ê');
        } else if(levelKey === 'chill'){
          popupEmojiBurst('üòé');
          showTinyNote((targetUser === 'pablo' ? 'Pablo' : 'Ana') + ' est√° de boa / chill üòé');
        } else if(levelKey === 'ice'){
          iceRain();
          showTinyNote((targetUser === 'pablo' ? 'Pablo' : 'Ana') + ' est√° em gelo fino üßä');
        } else if(levelKey === 'jail'){
          showJailAnimation(targetUser);
          popupEmojiBurst('‚õìÔ∏è');
          showTinyNote((targetUser === 'pablo' ? 'Pablo' : 'Ana') + ' foi pra cadeia üò¨');
        }

        if(db){
          firebase.database().ref('satisfaction/' + coupleId + '/' + targetUser).set(levelKey)
            .catch(err => console.warn('Erro ao salvar no Firebase:', err));
        }
      });
    });

    function placeMarker(user, levelKey){
      const row = levelMap[levelKey];
      if(!row) return;
      const container = row.querySelector('.sat-markers');
      const emoji = levelEmoji[levelKey] || '‚ù§';
      const marker = (user === 'pablo') ? markerPablo : markerAna;
      const letra = (user === 'pablo') ? 'P ' : 'A ';
      marker.textContent = letra + emoji;
      container.appendChild(marker);

      jailStatus[user] = (levelKey === 'jail');
      updateJailUIFromStatus();
    }

    function updateJailUIFromStatus(){
      const someone = jailStatus.pablo ? 'pablo' : (jailStatus.ana ? 'ana' : null);
      jailFor = someone;
      if(!jailFor){
        jailExtra.style.display = 'none';
        return;
      }
      jailExtra.style.display = 'block';
      const alvoNome = jailFor === 'pablo' ? 'Pablo' : 'Ana';
      jailLabel.textContent = `O que o ${alvoNome} pode fazer para sair da cadeia?`;

      const noteKey = 'jailNote_' + jailFor;
      const note = localStorage.getItem(noteKey) || '';
      jailText.value = note;
    }

    function showJailAnimation(forUser){
      if(!satCard) return;
      const wrap = document.createElement('div');
      wrap.className = 'jail-anim';
      const bars = document.createElement('div');
      bars.className = 'jail-bars';
      for(let i=0;i<5;i++){
        const s = document.createElement('span');
        bars.appendChild(s);
      }
      wrap.appendChild(bars);
      satCard.appendChild(wrap);
      setTimeout(()=>{ wrap.style.opacity='0'; }, 900);
      setTimeout(()=> wrap.remove(), 1300);
    }

    jailSaveBtn.addEventListener('click', () => {
      if(!jailFor){
        alert('Ningu√©m est√° na cadeia agora üòÇ');
        return;
      }
      const text = jailText.value.trim();
      const key = 'jailNote_' + jailFor;
      localStorage.setItem(key, text);
      if(db){
        firebase.database().ref('satisfaction/' + coupleId + '/note_' + jailFor).set(text)
          .catch(err => console.warn('Erro ao salvar nota da cadeia:', err));
      }
      showTinyNote('Plano para sair da cadeia salvo üìù');
    });

    const localPablo = localStorage.getItem('satLevel_pablo');
    const localAna = localStorage.getItem('satLevel_ana');
    if(localPablo) placeMarker('pablo', localPablo);
    if(localAna) placeMarker('ana', localAna);

    if(db){
      firebase.database().ref('satisfaction/' + coupleId).on('value', snapshot => {
        const data = snapshot.val() || {};
        if(data.pablo) {
          localStorage.setItem('satLevel_pablo', data.pablo);
          placeMarker('pablo', data.pablo);
        }
        if(data.ana)   {
          localStorage.setItem('satLevel_ana', data.ana);
          placeMarker('ana', data.ana);
        }
        if(data.note_pablo){
          localStorage.setItem('jailNote_pablo', data.note_pablo);
          if(jailFor === 'pablo') jailText.value = data.note_pablo;
        }
        if(data.note_ana){
          localStorage.setItem('jailNote_ana', data.note_ana);
          if(jailFor === 'ana') jailText.value = data.note_ana;
        }
      });
    }

    // ENQUETE "SEXO HOJE"
    const pollSexoBtns = document.querySelectorAll('.poll-btn[data-poll="sexo"]');
    const pollSexoStatus = document.getElementById('pollSexoStatus');

    function setSexoUI(choice){
      pollSexoBtns.forEach(btn => {
        btn.classList.toggle('selected', btn.getAttribute('data-value') === choice);
      });

      if(choice === 'sim'){
        pollSexoStatus.textContent = '√öltima resposta: Sim üòà';
      }else if(choice === 'nao'){
        pollSexoStatus.textContent = '√öltima resposta: N√£o üôÖ‚Äç‚ôÄÔ∏è';
      }else{
        pollSexoStatus.textContent = 'Ainda sem resposta hoje.';
      }
    }

    pollSexoBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const choice = btn.getAttribute('data-value');
        setSexoUI(choice);
        if(db){
          firebase.database().ref('polls/' + coupleId + '/sexoHoje').set({
            value: choice,
            updatedAt: Date.now()
          }).catch(err => console.warn('Erro ao salvar enquete sexoHoje:', err));
        }
      });
    });

    if(db){
      firebase.database().ref('polls/' + coupleId + '/sexoHoje').on('value', snap => {
        const data = snap.val();
        if(!data || !data.value){
          setSexoUI(null);
          return;
        }
        setSexoUI(data.value);
      });
    }

    // CARD√ÅPIO DO DIA
    const menuInput  = document.getElementById('menuInput');
    const menuSaveBtn = document.getElementById('menuSaveBtn');
    const menuStatus = document.getElementById('menuStatus');

    menuSaveBtn.addEventListener('click', () => {
      const text = (menuInput.value || '').trim();
      if(!text){
        alert('Escreve alguma coisa pro card√°pio üòã');
        return;
      }
      if(db){
        firebase.database().ref('polls/' + coupleId + '/cardapioHoje').set({
          text,
          updatedAt: Date.now()
        }).then(() => {
          showTinyNote('Card√°pio atualizado üçΩÔ∏è');
        }).catch(err => console.warn('Erro ao salvar card√°pio:', err));
      }else{
        menuStatus.textContent = 'Sugest√£o atual: ' + text;
      }
    });

    if(db){
      firebase.database().ref('polls/' + coupleId + '/cardapioHoje').on('value', snap => {
        const data = snap.val();
        if(!data || !data.text){
          menuStatus.textContent = 'Sem sugest√£o ainda. Escrevam algo gostoso pra hoje üòã';
          return;
        }
        menuInput.value = data.text;
        menuStatus.textContent = 'Sugest√£o atual: ' + data.text;
      });
    }
  </script>

  <script>
    // CONTAGEM REGRESSIVA PARA O ENCONTRO
    (function(){
      var countdownTimeEl = document.getElementById('countdownTime');
      var countdownMsgEl  = document.getElementById('countdownMsg');

      if(!countdownTimeEl || !countdownMsgEl) return;

      // Encontro: 19/11/2025 √†s 18h (hor√°rio local - Brasil)
      // meses: 0 = jan, 10 = nov
      var targetDate = new Date(2025, 10, 19, 18, 0, 0);

      function pad2(n){
        return (n < 10 ? '0' : '') + n;
      }

      function updateCountdown(){
        var now  = new Date();
        var diff = targetDate.getTime() - now.getTime();

        if(diff <= 0){
          countdownTimeEl.innerHTML =
            '<span>00d</span> <span>00h</span> <span>00m</span> <span>00s</span>';
          countdownMsgEl.textContent =
            'J√° √© o dia do encontro! Espero que voc√™s estejam juntinhos agora üíñ';
          return;
        }

        var totalSeconds = Math.floor(diff / 1000);
        var days    = Math.floor(totalSeconds / 86400);
        var hours   = Math.floor((totalSeconds % 86400) / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;

        var htmlTime =
          '<span>' + pad2(days)    + 'd</span> ' +
          '<span>' + pad2(hours)   + 'h</span> ' +
          '<span>' + pad2(minutes) + 'm</span> ' +
          '<span>' + pad2(seconds) + 's</span>';

        countdownTimeEl.innerHTML = htmlTime;

        var msg;
        if(days > 1){
          msg = 'Faltam ' + days + ' dias pro pr√≥ximo encontro. Aguenta cora√ß√£ozinho üíò';
        }else if(days === 1){
          msg = 'Falta 1 dia pro encontro! J√° pode come√ßar a surtar de ansiedade ü•π';
        }else{
          msg = '√â hoje! Daqui a pouquinho voc√™s v√£o se abra√ßar üíû';
        }
        countdownMsgEl.textContent = msg;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);
    })();
  </script>
</body>
</html>
